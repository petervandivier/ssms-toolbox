{
  "id": "ed59bd64-6f4f-46bb-ac5f-c11c9d9e0248",
  "prefix": "mf",
  "description": "Master Files",
  "body": "$SELECTIONSTART$\ndrop table if exists #fullness;\ncreate table #fullness (\n     database_id int not null\n    ,fname sysname \n    ,space_used_mb float\n)\ninsert #fullness (database_id, fname, space_used_mb)\nexec sys.sp_MSforeachdb N'use [?]\nselect \n    mf.database_id\n    ,mf.[name]\n    ,(try_cast(fileproperty(mf.[name],''SpaceUsed'') as int) * 8192.) / power(1024.,2)\nfrom sys.master_files mf\nwhere db_name(mf.database_id) in (''?'')\n'; -- select * from #fullness f\n\nselect [dbid]=mf.database_id\n      ,mf.[type_desc]\n      ,mf.[name]\n      ,mf.physical_name\n      ,mf.state_desc\n      ,size_mb=try_convert(float,(mf.size*8192.)/power(1024,2))\n      ,f.space_used_mb\n      ,max_size_mb=try_convert(float,(nullif(mf.max_size,-1)*8192.)/power(1024,2))\n      ,pct_full = try_convert(decimal(10,4),f.space_used_mb / ((mf.size*8192.)/power(1024,2)))*100.\n      ,growth_mb=case mf.is_percent_growth when 1 then (mf.growth/100.)*try_convert(float,(mf.size*8192.)/power(1024,2)) else try_convert(float,(mf.growth*8192.)/power(1024,2)) end\n      ,pct=mf.is_percent_growth\n      ,diff_age_time=convert(time(0),dateadd(second,datediff(second,mf.differential_base_time,getutcdate()),0))\n      ,diff_age_days=datediff(day,mf.differential_base_time,getutcdate())\nfrom sys.master_files mf\njoin #fullness f \n    on f.database_id = mf.database_id \n    and f.fname = mf.[name]\nwhere db_name(mf.database_id) in ('$DBNAME$')\n$SELECTIONEND$"
}