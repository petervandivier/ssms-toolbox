{
  "id": "73048fd8-cda3-4150-9b21-1a5ae6fd8779",
  "prefix": "xer",
  "description": "Create but do not start a new RDS XE on executions fuzzy matching input text",
  "body": "/*\r\ntrace executions of SQL Text based on a fuzzy match\r\ncreates an XE logging to the default RDS location\r\ndoes not start the XE\r\n*/\r\ncreate event session [$XE_NAME$]\r\n    on server\r\n    add event sqlserver.exec_prepared_sql (\r\n        action (\r\n            sqlserver.client_app_name,\r\n            sqlserver.client_hostname,\r\n            sqlserver.database_id,\r\n            sqlserver.[database_name],\r\n            sqlserver.nt_username,\r\n            sqlserver.query_hash_signed,\r\n            sqlserver.server_principal_name,\r\n            sqlserver.[session_id],\r\n            sqlserver.sql_text,\r\n            sqlserver.tsql_stack,\r\n            sqlserver.username\r\n        )\r\n        where (\r\n            sqlserver.[database_name] = N'$DB_NAME$'\r\n            and package0.equal_boolean(sqlserver.is_system, 0)\r\n            and sqlserver.like_i_sql_unicode_string(\r\n                sqlserver.sql_text, \r\n                N'%$SQL_TEXT$%'\r\n            )\r\n        )\r\n    ),\r\n    add event sqlserver.prepare_sql(\r\n        action (\r\n            sqlserver.client_app_name,\r\n            sqlserver.client_hostname,\r\n            sqlserver.database_id,\r\n            sqlserver.[database_name],\r\n            sqlserver.nt_username,\r\n            sqlserver.query_hash_signed,\r\n            sqlserver.server_principal_name,\r\n            sqlserver.[session_id],\r\n            sqlserver.sql_text,\r\n            sqlserver.tsql_stack,\r\n            sqlserver.username\r\n        )\r\n        where (\r\n            sqlserver.[database_name] = N'$DB_NAME$'\r\n            and package0.equal_boolean(sqlserver.is_system, 0)\r\n            and sqlserver.like_i_sql_unicode_string(\r\n                sqlserver.sql_text, \r\n                N'%$SQL_TEXT$%'\r\n            )\r\n        )\r\n    ),\r\n    add event sqlserver.rpc_completed (\r\n        set collect_data_stream = 1\r\n        action (\r\n            sqlserver.client_app_name,\r\n            sqlserver.client_hostname,\r\n            sqlserver.database_id,\r\n            sqlserver.[database_name],\r\n            sqlserver.nt_username,\r\n            sqlserver.query_hash_signed,\r\n            sqlserver.server_principal_name,\r\n            sqlserver.[session_id],\r\n            sqlserver.sql_text,\r\n            sqlserver.tsql_stack,\r\n            sqlserver.username\r\n        )\r\n        where (\r\n            sqlserver.[database_name] = N'$DB_NAME$'\r\n            and package0.equal_boolean(sqlserver.is_system, 0)\r\n            and sqlserver.like_i_sql_unicode_string(\r\n                sqlserver.sql_text, \r\n                N'%$SQL_TEXT$%'\r\n            )\r\n        )\r\n    ),\r\n    add event sqlserver.sp_statement_completed (\r\n        action (\r\n            sqlserver.client_app_name,\r\n            sqlserver.client_hostname,\r\n            sqlserver.database_id,\r\n            sqlserver.[database_name],\r\n            sqlserver.nt_username,\r\n            sqlserver.query_hash_signed,\r\n            sqlserver.server_principal_name,\r\n            sqlserver.[session_id],\r\n            sqlserver.sql_text,\r\n            sqlserver.tsql_stack,\r\n            sqlserver.username\r\n        )\r\n        where (\r\n            sqlserver.[database_name] = N'$DB_NAME$'\r\n            and package0.equal_boolean(sqlserver.is_system, 0)\r\n            and sqlserver.like_i_sql_unicode_string(\r\n                sqlserver.sql_text, \r\n                N'%$SQL_TEXT$%'\r\n            )\r\n        )\r\n    ),\r\n    add event sqlserver.sql_batch_completed (\r\n        set collect_batch_text = 1\r\n        action (\r\n            sqlserver.client_app_name,\r\n            sqlserver.client_hostname,\r\n            sqlserver.database_id,\r\n            sqlserver.[database_name],\r\n            sqlserver.nt_username,\r\n            sqlserver.query_hash_signed,\r\n            sqlserver.server_principal_name,\r\n            sqlserver.[session_id],\r\n            sqlserver.sql_text,\r\n            sqlserver.tsql_stack,\r\n            sqlserver.username\r\n        )\r\n        where (\r\n            sqlserver.[database_name] = N'$DB_NAME$'\r\n            and package0.equal_boolean(sqlserver.is_system, 0)\r\n            and sqlserver.like_i_sql_unicode_string(\r\n                sqlserver.sql_text, \r\n                N'%$SQL_TEXT$%'\r\n            )\r\n        )\r\n    )\r\n    add target package0.event_file (\r\n        set \r\n            filename    = N'D:\\rdsdbdata\\Log\\$XE_NAME$.xel', \r\n            max_file_size = 100\r\n    )\r\n    with (\r\n        max_memory            = 4096kb,\r\n        event_retention_mode  = allow_single_event_loss,\r\n        max_dispatch_latency  = 30 seconds,\r\n        max_event_size        = 0kb,\r\n        memory_partition_mode = none,\r\n        track_causality       = off,\r\n        startup_state         = off\r\n    )\r\n;\r\ngo\r\n",
  "placeholders": [
    {
      "name": "XE_NAME",
      "defaultValue": null
    },
    {
      "name": "DB_NAME",
      "defaultValue": null
    },
    {
      "name": "SQL_TEXT",
      "defaultValue": null
    }
  ]
}